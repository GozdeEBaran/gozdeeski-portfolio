<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quick Debug Check</title>
    <style>
      body {
        font-family: monospace;
        max-width: 900px;
        margin: 50px auto;
        padding: 20px;
        background: #1e1e1e;
        color: #00ff00;
      }
      .check {
        margin: 15px 0;
        padding: 15px;
        background: #2d2d2d;
        border-radius: 5px;
      }
      .success {
        color: #00ff00;
      }
      .error {
        color: #ff4444;
      }
      .info {
        color: #44aaff;
      }
      pre {
        background: #000;
        padding: 10px;
        border-radius: 3px;
        overflow-x: auto;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  </head>
  <body>
    <h1>üîç QUICK DEBUG CHECK</h1>
    <div id="results"></div>

    <script>
      const results = document.getElementById("results");

      function log(msg, type = "info") {
        const colors = {
          success: "#00ff00",
          error: "#ff4444",
          info: "#44aaff",
        };
        results.innerHTML += `<div class="check" style="color: ${colors[type]}">${msg}</div>`;
      }

      async function runChecks() {
        // Check 1: Supabase Library
        log("1Ô∏è‚É£ Checking if Supabase library loaded...", "info");
        if (typeof window.supabase !== "undefined") {
          log("   ‚úÖ Supabase library is loaded!", "success");
        } else {
          log("   ‚ùå Supabase library NOT loaded!", "error");
          return;
        }

        // Check 2: Config file
        log("2Ô∏è‚É£ Loading supabase-config.js...", "info");
        try {
          const response = await fetch("supabase-config.js");
          const text = await response.text();

          if (text.includes("YOUR_SUPABASE_URL")) {
            log("   ‚ùå Config still has placeholder values!", "error");
            return;
          } else if (text.includes("eecedtxrjuvwnjmiwodc")) {
            log("   ‚úÖ Config has real credentials!", "success");
          } else {
            log("   ‚ö†Ô∏è Config exists but values unclear", "error");
          }
        } catch (e) {
          log("   ‚ùå Could not load config: " + e.message, "error");
          return;
        }

        // Wait for config to load
        await new Promise((resolve) => setTimeout(resolve, 500));

        // Check 3: Config loaded in window
        log("3Ô∏è‚É£ Checking if config is available...", "info");
        if (typeof window.supabaseConfig !== "undefined") {
          log("   ‚úÖ supabaseConfig is available!", "success");
        } else {
          log(
            "   ‚ùå supabaseConfig NOT available! Check browser console for errors.",
            "error",
          );
          return;
        }

        // Check 4: Configuration check
        log("4Ô∏è‚É£ Running isSupabaseConfigured()...", "info");
        const isConfigured = window.supabaseConfig.isSupabaseConfigured();
        if (isConfigured) {
          log("   ‚úÖ Configuration check PASSED!", "success");
        } else {
          log(
            "   ‚ùå Configuration check FAILED! This should not happen if credentials are set.",
            "error",
          );
          return;
        }

        // Check 5: Initialize client
        log("5Ô∏è‚É£ Initializing Supabase client...", "info");
        const client = window.supabaseConfig.initializeSupabase();
        if (client) {
          log("   ‚úÖ Supabase client initialized!", "success");
        } else {
          log("   ‚ùå Failed to initialize client!", "error");
          return;
        }

        // Check 6: Test database connection
        log("6Ô∏è‚É£ Testing database connection...", "info");
        try {
          const { data, error } = await client
            .from("contact_submissions")
            .select("*")
            .limit(1);

          if (error) {
            log("   ‚ùå Database error: " + error.message, "error");
            if (error.message.includes("does not exist")) {
              log(
                "   ‚Üí Table needs to be created! Run the SQL script.",
                "error",
              );
            }
          } else {
            log("   ‚úÖ Database connection successful!", "success");
            log('   ‚úÖ Table "contact_submissions" exists!', "success");
            log(
              `   üìä Current entries in database: ${data?.length || 0}`,
              "info",
            );
          }
        } catch (e) {
          log("   ‚ùå Connection test failed: " + e.message, "error");
        }

        // Check 7: Test form submission
        log("7Ô∏è‚É£ Testing form submission...", "info");
        try {
          const testData = {
            name: "Debug Test",
            email: "debug@test.com",
            message:
              "This is a test message from debug-check.html at " +
              new Date().toLocaleString(),
          };

          const result =
            await window.supabaseConfig.submitContactForm(testData);

          if (result.success) {
            log("   ‚úÖ Form submission SUCCESSFUL!", "success");
            log("   ‚úÖ Your contact form is working perfectly!", "success");
            log(
              `   <pre>${JSON.stringify(result.data, null, 2)}</pre>`,
              "success",
            );
          } else {
            log("   ‚ùå Form submission FAILED: " + result.error, "error");
          }
        } catch (e) {
          log("   ‚ùå Form submission error: " + e.message, "error");
        }

        // Final result
        log("", "info");
        log("üéâ ============================================", "success");
        log("   ALL CHECKS PASSED!", "success");
        log("   Your portfolio is fully functional!", "success");
        log("   Contact form will save submissions to database.", "success");
        log("============================================", "success");
      }

      // Run checks after page loads
      window.addEventListener("load", () => {
        // Load config first
        const script = document.createElement("script");
        script.src = "supabase-config.js";
        script.onload = () => {
          setTimeout(runChecks, 100);
        };
        script.onerror = () => {
          log("‚ùå FATAL: Could not load supabase-config.js", "error");
        };
        document.head.appendChild(script);
      });
    </script>
  </body>
</html>
